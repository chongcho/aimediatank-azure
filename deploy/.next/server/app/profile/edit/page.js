(()=>{var e={};e.id=3159,e.ids=[3159],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8533:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d}),a(34049),a(58567),a(35866);var r=a(23191),s=a(88716),i=a(37922),l=a.n(i),n=a(95231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);a.d(t,o);let d=["",{children:["profile",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,34049)),"C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\profile\\edit\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,58567)),"C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\profile\\edit\\page.tsx"],m="/profile/edit/page",u={require:a,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/profile/edit/page",pathname:"/profile/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},810:(e,t,a)=>{Promise.resolve().then(a.bind(a,73841))},35047:(e,t,a)=>{"use strict";var r=a(77389);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},73841:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var r=a(10326),s=a(17577),i=a(77109),l=a(35047),n=a(91752);function o(){let{data:e,status:t}=(0,i.useSession)(),a=(0,l.useRouter)(),[o,d]=(0,s.useState)(!0),[c,m]=(0,s.useState)(!1),[u,p]=(0,s.useState)(!1),[x,h]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[b,v]=(0,s.useState)(!1),[y,j]=(0,s.useState)(""),[w,N]=(0,s.useState)({name:"",legalName:"",username:"",email:"",phone:"",location:"",ageRange:"",bio:"",password:"",confirmPassword:"",emailVerified:!1,avatar:null}),[k,P]=(0,s.useState)(null),[C,S]=(0,s.useState)(!1),U=(0,s.useRef)(null),E=async e=>{let t=e.target.files?.[0];if(!t)return;if(!t.type.startsWith("image/")){h("Please select an image file");return}let a=URL.createObjectURL(t);P(a),S(!0),h("");try{let e=await (0,n.hv)(t,{maxWidth:400,maxHeight:400,quality:.8}),r=await fetch("/api/upload/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:`avatar-${Date.now()}.jpg`,contentType:"image/jpeg",fileType:"IMAGE"})});if(!r.ok)throw Error("Failed to get upload URL");let{uploadUrl:s,blobUrl:i}=await r.json();if(!(await fetch(s,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":"image/jpeg"},body:e})).ok)throw Error("Failed to upload avatar");if(!(await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:i})})).ok)throw Error("Failed to save avatar");let l=`${i}?t=${Date.now()}`;P(l),N(e=>({...e,avatar:i})),URL.revokeObjectURL(a),window.dispatchEvent(new Event("profileUpdated")),f("Avatar updated successfully!"),setTimeout(()=>f(""),3e3)}catch(e){console.error("Avatar upload error:",e),h("Failed to upload avatar. Please try again."),P(w.avatar),URL.revokeObjectURL(a)}finally{S(!1)}},L=async()=>{p(!0),v(!1),j("");try{let e=await fetch("/api/auth/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:w.email})}),t=await e.json();e.ok?(v(!0),t.devUrl&&j(t.devUrl)):h(t.error||"Failed to send verification email")}catch(e){h("Something went wrong")}finally{p(!1)}},M=async e=>{if(e.preventDefault(),h(""),f(""),w.password&&w.password!==w.confirmPassword){h("Passwords do not match");return}if(w.password&&w.password.length<6){h("Password must be at least 6 characters");return}m(!0);try{let e={name:w.name,legalName:w.legalName,username:w.username,email:w.email,phone:w.phone,location:w.location,ageRange:w.ageRange,bio:w.bio,avatar:w.avatar};w.password&&(e.password=w.password);let t=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();t.ok?(f("Profile updated successfully!"),N(e=>({...e,password:"",confirmPassword:""})),window.dispatchEvent(new Event("profileUpdated")),setTimeout(()=>{a.push(`/profile/${r.user.username}`)},1500)):h(r.error||"Failed to update profile")}catch(e){h("Something went wrong")}finally{m(!1)}};return"loading"===t||o?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"spinner"})}):(0,r.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-12",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Edit Profile"}),r.jsx("p",{className:"text-gray-400",children:"Update your account information"})]}),r.jsx("div",{className:"card",children:(0,r.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[x&&r.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 text-sm",children:x}),g&&r.jsx("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-xl text-green-400 text-sm",children:g}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[r.jsx("div",{className:"relative",children:(0,r.jsxs)("div",{className:"w-24 h-24 rounded-full overflow-hidden border-2 border-tank-light",children:[k?r.jsx("img",{src:k,alt:"Avatar",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-gradient-to-br from-tank-accent to-purple-500 flex items-center justify-center text-3xl font-bold",children:w.name?.[0]?.toUpperCase()||w.username?.[0]?.toUpperCase()||"?"}),C&&r.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full",children:r.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})})]})}),r.jsx("input",{ref:U,type:"file",accept:"image/*",onChange:E,className:"hidden"}),(0,r.jsxs)("button",{type:"button",onClick:()=>{U.current?.click()},disabled:C,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-tank-gray hover:bg-tank-light border border-tank-light rounded-lg transition-colors disabled:opacity-50",children:[(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),C?"Uploading...":"Edit Avatar"]})]}),(0,r.jsxs)("div",{className:"text-left space-y-2",children:[r.jsx("div",{children:r.jsx("input",{type:"text",value:w.name,onChange:e=>N({...w,name:e.target.value}),placeholder:"Your Name",className:"text-2xl font-bold bg-transparent border-b-2 border-transparent hover:border-tank-light focus:border-tank-accent transition-colors outline-none w-full"})}),r.jsx("p",{className:"text-sm text-gray-400",children:"Nickname"})]})]}),(0,r.jsxs)("div",{className:`p-4 rounded-xl ${w.emailVerified?"bg-green-500/10 border border-green-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[w.emailVerified?r.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:r.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):r.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center",children:r.jsx("svg",{className:"w-4 h-4 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:`font-medium ${w.emailVerified?"text-green-400":"text-yellow-400"}`,children:w.emailVerified?"Email Verified":"Email Not Verified"}),r.jsx("p",{className:"text-xs text-gray-500",children:w.emailVerified?"Your email address has been verified":"Please verify your email address"})]})]}),!w.emailVerified&&r.jsx("button",{type:"button",onClick:L,disabled:u||b,className:"px-3 py-1.5 bg-yellow-500/20 text-yellow-400 rounded-lg text-sm hover:bg-yellow-500/30 disabled:opacity-50",children:u?"Sending...":b?"Sent!":"Verify"})]}),y&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-yellow-500/20",children:[r.jsx("p",{className:"text-xs text-yellow-400 mb-1",children:"\uD83D\uDD27 Dev verification link:"}),r.jsx("a",{href:y,className:"text-xs text-tank-accent break-all hover:underline",children:y})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"User Name (Legal Name)"}),r.jsx("input",{type:"text",value:w.legalName,onChange:e=>N({...w,legalName:e.target.value}),placeholder:"Your full legal name",className:"w-full"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your legal name for account records"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"User ID *"}),r.jsx("input",{type:"text",value:w.username,onChange:e=>N({...w,username:e.target.value}),placeholder:"username",className:"w-full",required:!0}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Used for login and your profile URL"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email *"}),r.jsx("input",{type:"email",value:w.email,onChange:e=>N({...w,email:e.target.value}),placeholder:"your@email.com",className:"w-full",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Phone Number"}),r.jsx("input",{type:"tel",value:w.phone,onChange:e=>N({...w,phone:e.target.value}),placeholder:"+1 (555) 000-0000",className:"w-full"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),r.jsx("input",{type:"text",value:w.location,onChange:e=>N({...w,location:e.target.value}),placeholder:"City, Country",className:"w-full"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Age Range *"}),(0,r.jsxs)("select",{value:w.ageRange,onChange:e=>N({...w,ageRange:e.target.value}),className:"w-full",required:!0,children:[r.jsx("option",{value:"",children:"Select your age range"}),r.jsx("option",{value:"UNDER_18",children:"Under 18"}),r.jsx("option",{value:"18_PLUS",children:"18 and over"})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Required for content filtering"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Bio"}),r.jsx("textarea",{value:w.bio,onChange:e=>N({...w,bio:e.target.value}),placeholder:"Tell others about yourself...",rows:3,className:"w-full resize-none"})]}),(0,r.jsxs)("div",{className:"border-t border-tank-light pt-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Change Password"}),r.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Leave blank to keep current password"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"New Password"}),r.jsx("input",{type:"password",value:w.password,onChange:e=>N({...w,password:e.target.value}),placeholder:"••••••••",className:"w-full",minLength:6})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm New Password"}),r.jsx("input",{type:"password",value:w.confirmPassword,onChange:e=>N({...w,confirmPassword:e.target.value}),placeholder:"••••••••",className:"w-full"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-4 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>a.back(),className:"flex-1 px-4 py-3 bg-tank-gray border border-tank-light rounded-xl hover:bg-tank-light transition-colors",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:c,className:"flex-1 btn-primary",children:c?"Saving...":"Save Changes"})]})]})})]})}},91752:(e,t,a)=>{"use strict";a.d(t,{F$:()=>n,hv:()=>i});let r={maxWidth:1920,maxHeight:1080,quality:.8,maxSizeMB:5},s={maxWidth:1920,maxHeight:1080,maxSizeMB:100};async function i(e,t={}){let a={...r,...t};return new Promise((t,r)=>{let s=new Image,i=document.createElement("canvas"),l=i.getContext("2d");if(!l){r(Error("Could not get canvas context"));return}s.onload=()=>{let{width:n,height:o}=s,d=a.maxWidth||1920,c=a.maxHeight||1080;n>d&&(o=o*d/n,n=d),o>c&&(n=n*c/o,o=c),i.width=n,i.height=o,l.drawImage(s,0,0,n,o),i.toBlob(a=>{if(!a){r(Error("Failed to compress image"));return}let s=new File([a],e.name,{type:"image/jpeg",lastModified:Date.now()});console.log(`Image compressed: ${(e.size/1024/1024).toFixed(2)}MB -> ${(s.size/1024/1024).toFixed(2)}MB`),t(s)},"image/jpeg",a.quality||.8)},s.onerror=()=>r(Error("Failed to load image")),s.src=URL.createObjectURL(e)})}async function l(e,t={},a){let r={...s,...t};return new Promise((t,s)=>{let i=document.createElement("video");i.muted=!0,i.playsInline=!0,i.onloadedmetadata=async()=>{try{let{videoWidth:l,videoHeight:n}=i,o=r.maxWidth||1920,d=r.maxHeight||1080;l>o&&(n=n*o/l,l=o),n>d&&(l=l*d/n,n=d),l=2*Math.round(l/2),n=2*Math.round(n/2);let c=document.createElement("canvas");c.width=l,c.height=n;let m=c.getContext("2d");if(!m){s(Error("Could not get canvas context"));return}let u=c.captureStream(30);try{let e=new AudioContext,t=e.createMediaElementSource(i),a=e.createMediaStreamDestination();t.connect(a),t.connect(e.destination),a.stream.getAudioTracks().forEach(e=>{u.addTrack(e)})}catch(e){console.log("No audio track or audio context unavailable")}let p=new MediaRecorder(u,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5}),x=[];p.ondataavailable=e=>{e.data.size>0&&x.push(e.data)},p.onstop=()=>{let a=new Blob(x,{type:"video/webm"}),r=new File([a],e.name.replace(/\.[^.]+$/,".webm"),{type:"video/webm",lastModified:Date.now()});console.log(`Video compressed: ${(e.size/1024/1024).toFixed(2)}MB -> ${(r.size/1024/1024).toFixed(2)}MB`),t(r)},p.onerror=e=>s(e),p.start(100),i.currentTime=0,await i.play();let h=()=>{if(i.ended||i.paused){p.stop();return}if(m.drawImage(i,0,0,l,n),a){let e=i.currentTime/i.duration*100;a(Math.round(e))}requestAnimationFrame(h)};h(),i.onended=()=>{p.stop()}}catch(e){s(e)}},i.onerror=()=>s(Error("Failed to load video")),i.src=URL.createObjectURL(e)})}async function n(e,t,a){if(e.size<1048576*("IMAGE"===t?1:10))return console.log(`File is small (${(e.size/1024/1024).toFixed(2)}MB), skipping compression`),e;switch(t){case"IMAGE":return i(e);case"VIDEO":return l(e,{},a);case"MUSIC":return console.log("Audio compression not supported, using original file"),e;default:return e}}},34049:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>l,__esModule:()=>i,default:()=>n});var r=a(68570);let s=(0,r.createProxy)(String.raw`C:\Users\chong\AI Studio\aimediatank-azure\src\app\profile\edit\page.tsx`),{__esModule:i,$$typeof:l}=s;s.default;let n=(0,r.createProxy)(String.raw`C:\Users\chong\AI Studio\aimediatank-azure\src\app\profile\edit\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5559,4613],()=>a(8533));module.exports=r})();