"use strict";(()=>{var e={};e.id=7166,e.ids=[7166],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92798:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>l,dynamic:()=>u});var i=a(49303),n=a(88716),s=a(60670),o=a(87070),d=a(20728);let u="force-dynamic";async function l(e){try{let{searchParams:t}=new URL(e.url),a=t.get("type"),r=t.get("sort")||"popular",i=parseInt(t.get("page")||"1"),n=parseInt(t.get("limit")||"20"),s=t.get("search"),u=t.get("user"),l=(i-1)*n,c={isPublic:!0,isApproved:!0};u&&(c.user={username:u}),a&&["VIDEO","IMAGE","MUSIC"].includes(a)&&(c.type=a),s&&(c.OR=[{title:{contains:s}},{description:{contains:s}},{aiTool:{contains:s}}]);let p={views:"desc"};"recent"===r&&(p={createdAt:"desc"});let[m,g]=await Promise.all([d._.media.findMany({where:c,orderBy:p,skip:l,take:n,include:{user:{select:{id:!0,username:!0,name:!0,avatar:!0}},ratings:{select:{score:!0}},_count:{select:{comments:!0,ratings:!0}}}}),d._.media.count({where:c})]),h=new Date,v=m.map(e=>{let t=e.ratings.length>0?e.ratings.reduce((e,t)=>e+t.score,0)/e.ratings.length:0,a=null;if(e.isSold&&e.deleteAfter){let t=new Date(e.deleteAfter).getTime()-h.getTime();a=Math.ceil(t/864e5)}return{...e,avgRating:Math.round(10*t)/10,ratings:void 0,daysRemaining:a}});return"rated"===r&&v.sort((e,t)=>t.avgRating-e.avgRating),o.NextResponse.json({media:v,pagination:{page:i,limit:n,total:g,totalPages:Math.ceil(g/n)}})}catch(e){return console.error("Error fetching media:",e),o.NextResponse.json({error:"Failed to fetch media"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/media/route",pathname:"/api/media",filename:"route",bundlePath:"app/api/media/route"},resolvedPagePath:"C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\api\\media\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g}=c,h="/api/media/route";function v(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},20728:(e,t,a)=>{a.d(t,{_:()=>i});let r=require("@prisma/client"),i=globalThis.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>a(92798));module.exports=r})();