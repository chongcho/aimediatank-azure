(()=>{var e={};e.id=4750,e.ids=[4750],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},98555:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c}),s(8501),s(58567),s(35866);var a=s(23191),r=s(88716),n=s(37922),i=s.n(n),l=s(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8501)),"C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\messages\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,58567)),"C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\messages\\page.tsx"],u="/messages/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},38216:(e,t,s)=>{Promise.resolve().then(s.bind(s,94879))},35047:(e,t,s)=>{"use strict";var a=s(77389);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},94879:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(10326),r=s(17577),n=s(77109),i=s(35047),l=s(90434);function o(){let{data:e,status:t}=(0,n.useSession)();(0,i.useRouter)();let[s,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0),[u,m]=(0,r.useState)("inbox"),[x,p]=(0,r.useState)(null),[g,h]=(0,r.useState)(""),[f,b]=(0,r.useState)(!1),v=async e=>{try{await fetch("/api/messages",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageIds:e})})}catch(e){console.error("Error marking as read:",e)}},y=e=>{p(e),e.isRead||"inbox"!==u||(v([e.id]),o(t=>t.map(t=>t.id===e.id?{...t,isRead:!0}:t)))},j=async()=>{if(!g.trim()||!x)return;let e="inbox"===u?x.sender?.id:x.receiver?.id;if(e){b(!0);try{(await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:e,content:g})})).ok&&(h(""),alert("Reply sent!"))}catch(e){console.error("Error sending reply:",e)}finally{b(!1)}}},N=e=>{let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/864e5);return 0===s?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):1===s?"Yesterday":s<7?`${s} days ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})};if("loading"===t)return a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"spinner"})});if(!e)return null;let k=s.filter(e=>!e.isRead).length;return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[a.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Messages"}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsxs)("button",{onClick:()=>{m("inbox"),p(null)},className:`flex-1 px-4 py-2 rounded-xl font-medium ${"inbox"===u?"bg-tank-accent text-tank-black":"bg-tank-gray text-gray-400"}`,children:["Inbox","inbox"===u&&k>0&&a.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:k})]}),a.jsx("button",{onClick:()=>{m("sent"),p(null)},className:`flex-1 px-4 py-2 rounded-xl font-medium ${"sent"===u?"bg-tank-accent text-tank-black":"bg-tank-gray text-gray-400"}`,children:"Sent"})]}),a.jsx("div",{className:"card p-0 overflow-hidden",children:c?a.jsx("div",{className:"p-8 text-center",children:a.jsx("div",{className:"spinner mx-auto"})}):0===s.length?a.jsx("div",{className:"p-8 text-center text-gray-500",children:"No messages yet"}):a.jsx("div",{className:"divide-y divide-tank-light max-h-[60vh] overflow-y-auto",children:s.map(e=>{let t="inbox"===u?e.sender:e.receiver;return a.jsx("button",{onClick:()=>y(e),className:`w-full p-4 text-left hover:bg-tank-light/50 transition-colors ${x?.id===e.id?"bg-tank-light":""} ${e.isRead||"inbox"!==u?"":"bg-tank-accent/5"}`,children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-tank-accent to-purple-500 flex-shrink-0 flex items-center justify-center text-sm font-bold",children:t?.name?.[0]?.toUpperCase()||t?.username[0].toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-medium truncate",children:t?.name||t?.username}),a.jsx("span",{className:"text-xs text-gray-500",children:N(e.createdAt)})]}),a.jsx("p",{className:"text-sm text-gray-400 truncate",children:e.content})]}),!e.isRead&&"inbox"===u&&a.jsx("div",{className:"w-2 h-2 rounded-full bg-tank-accent flex-shrink-0 mt-2"})]})},e.id)})})})]}),a.jsx("div",{className:"lg:col-span-2",children:a.jsx("div",{className:"card h-full",children:x?(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 pb-4 border-b border-tank-light",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-tank-accent to-purple-500 flex items-center justify-center font-bold",children:("inbox"===u?x.sender?.name?.[0]:x.receiver?.name?.[0])?.toUpperCase()||("inbox"===u?x.sender?.username[0]:x.receiver?.username[0])?.toUpperCase()}),(0,a.jsxs)("div",{children:[a.jsx(l.default,{href:`/profile/${"inbox"===u?x.sender?.username:x.receiver?.username}`,className:"font-semibold hover:text-tank-accent",children:"inbox"===u?x.sender?.name||x.sender?.username:x.receiver?.name||x.receiver?.username}),a.jsx("p",{className:"text-sm text-gray-500",children:N(x.createdAt)})]})]}),a.jsx("div",{className:"flex-1 py-6",children:a.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:x.content})}),"inbox"===u&&(0,a.jsxs)("div",{className:"pt-4 border-t border-tank-light",children:[a.jsx("textarea",{value:g,onChange:e=>h(e.target.value),placeholder:"Write a reply...",rows:3,className:"mb-3 resize-none"}),a.jsx("button",{onClick:j,disabled:!g.trim()||f,className:"btn-primary",children:f?"Sending...":"Send Reply"})]})]}):a.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:"Select a message to view"})})})]})]})}},8501:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var a=s(68570);let r=(0,a.createProxy)(String.raw`C:\Users\chong\AI Studio\aimediatank-azure\src\app\messages\page.tsx`),{__esModule:n,$$typeof:i}=r;r.default;let l=(0,a.createProxy)(String.raw`C:\Users\chong\AI Studio\aimediatank-azure\src\app\messages\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,5559,4613],()=>s(98555));module.exports=a})();