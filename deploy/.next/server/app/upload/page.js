(()=>{var e={};e.id=5676,e.ids=[5676],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},98518:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d}),a(64929),a(58567),a(35866);var r=a(23191),i=a(88716),s=a(37922),o=a.n(s),n=a(95231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);a.d(t,l);let d=["",{children:["upload",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,64929)),"C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\upload\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,58567)),"C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\chong\\AI Studio\\aimediatank-azure\\src\\app\\upload\\page.tsx"],m="/upload/page",u={require:a,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/upload/page",pathname:"/upload",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},48395:(e,t,a)=>{Promise.resolve().then(a.bind(a,73881))},35047:(e,t,a)=>{"use strict";var r=a(77389);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},73881:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(10326),i=a(17577),s=a(77109),o=a(35047),n=a(91752);function l(){let{data:e,status:t}=(0,s.useSession)(),a=(0,o.useRouter)(),[l,d]=(0,i.useState)({title:"",description:"",type:"IMAGE",aiTool:"",aiPrompt:"",price:"",isPublic:!0}),[c,m]=(0,i.useState)(null),[u,p]=(0,i.useState)(null),[x,h]=(0,i.useState)(null),[g,y]=(0,i.useState)(!1),[b,v]=(0,i.useState)(""),[f,j]=(0,i.useState)(0),[w,N]=(0,i.useState)("");if("loading"===t)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"spinner"})});if(!e||"SUBSCRIBER"!==e.user.role&&"ADMIN"!==e.user.role)return r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),r.jsx("p",{className:"text-gray-400 mb-4",children:"Only subscribers can upload media."}),r.jsx("button",{onClick:()=>a.push("/register"),className:"btn-primary",children:"Become a Subscriber"})]})});let M=async e=>{try{let t=document.createElement("video");t.preload="metadata",t.muted=!0,t.playsInline=!0;let a=URL.createObjectURL(e);t.onloadeddata=()=>{t.currentTime=Math.min(1,.1*t.duration)},t.onseeked=()=>{try{let e=document.createElement("canvas"),r=Math.min(1,640/t.videoWidth);e.width=t.videoWidth*r,e.height=t.videoHeight*r;let i=e.getContext("2d");i&&(i.drawImage(t,0,0,e.width,e.height),e.toBlob(e=>{if(e){let t=new File([e],"thumbnail.jpg",{type:"image/jpeg"});p(t),console.log("Auto-generated video thumbnail")}URL.revokeObjectURL(a)},"image/jpeg",.8))}catch(e){console.log("Could not generate video thumbnail:",e),URL.revokeObjectURL(a)}},t.onerror=()=>{console.log("Video thumbnail generation failed"),URL.revokeObjectURL(a)},t.src=a}catch(e){console.log("Error generating video thumbnail:",e)}},P=async(e,t)=>{N("Getting upload URL...");let a=await fetch("/api/upload/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:e.name,contentType:e.type,fileType:t})});if(!a.ok)throw Error((await a.json()).error||"Failed to get upload URL");let{uploadUrl:r,blobUrl:i}=await a.json();if(N("Uploading to cloud storage..."),!(await fetch(r,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":e.type},body:e})).ok)throw Error("Failed to upload file to storage");return i},I=async e=>{if(e.preventDefault(),v(""),!c){v("Please select a file to upload");return}if(!l.title.trim()){v("Please enter a title");return}y(!0),j(0);try{N("Compressing file..."),j(5);let e=await (0,n.F$)(c,l.type,e=>{j(5+Math.round(.25*e)),N(`Compressing... ${e}%`)});console.log(`Original: ${(c.size/1024/1024).toFixed(2)}MB, Compressed: ${(e.size/1024/1024).toFixed(2)}MB`),j(30);let t=await P(e,l.type);j(70);let r=null;if(u){N("Compressing thumbnail...");let e=await (0,n.F$)(u,"IMAGE");N("Uploading thumbnail..."),r=await P(e,"IMAGE")}j(85),N("Saving media...");let i=await fetch("/api/upload/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:l.title,description:l.description,type:l.type,url:t,thumbnailUrl:r,aiTool:l.aiTool,aiPrompt:l.aiPrompt,price:l.price||null,isPublic:l.isPublic})});j(100);let s=await i.json();i.ok?(N("Upload complete!"),a.push(`/media/${s.media.id}`)):v(s.error||"Failed to save media")}catch(e){console.error("Upload error:",e),v(e instanceof Error?e.message:"Something went wrong")}finally{y(!1)}};return(0,r.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-12",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Upload AI Media"}),r.jsx("p",{className:"text-gray-400",children:"Share your AI-generated videos, images, or music with the community"})]}),r.jsx("div",{className:"card",children:(0,r.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[b&&r.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 text-sm",children:b}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Media Type *"}),r.jsx("div",{className:"grid grid-cols-3 gap-3",children:["IMAGE","VIDEO","MUSIC"].map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>d(t=>({...t,type:e})),className:`p-4 rounded-xl border transition-all ${l.type===e?"border-tank-accent bg-tank-accent/10":"border-tank-light hover:border-gray-600"}`,children:[r.jsx("div",{className:"text-2xl mb-2",children:"IMAGE"===e?"\uD83D\uDDBC️":"VIDEO"===e?"\uD83C\uDFAC":"\uD83C\uDFB5"}),r.jsx("div",{className:"font-medium",children:e})]},e))})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"File *"}),r.jsx("div",{className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${c?"border-tank-accent bg-tank-accent/5":"border-tank-light hover:border-gray-600"}`,onClick:()=>document.getElementById("file-input")?.click(),children:x?(0,r.jsxs)("div",{className:"space-y-4",children:["IMAGE"===l.type&&r.jsx("img",{src:x,alt:"Preview",className:"max-h-64 mx-auto rounded-lg"}),"VIDEO"===l.type&&r.jsx("video",{src:x,controls:!0,className:"max-h-64 mx-auto rounded-lg"}),r.jsx("p",{className:"text-sm text-gray-400",children:c?.name})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC1"}),r.jsx("p",{className:"text-gray-400",children:"Click to select or drag and drop your file"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["VIDEO"===l.type&&"MP4, WebM, MOV","IMAGE"===l.type&&"JPG, PNG, GIF, WebP","MUSIC"===l.type&&"MP3, WAV, OGG"]})]})}),r.jsx("input",{id:"file-input",type:"file",accept:"VIDEO"===l.type?"video/*":"IMAGE"===l.type?"image/*":"audio/*",onChange:e=>{let t=e.target.files?.[0];if(t){if(m(t),t.type.startsWith("image/")){let e=new FileReader;e.onload=()=>h(e.result),e.readAsDataURL(t)}else t.type.startsWith("video/")?(h(URL.createObjectURL(t)),M(t)):h(null)}},className:"hidden"})]}),("VIDEO"===l.type||"MUSIC"===l.type)&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Thumbnail ",u?"✓":"(optional)"]}),u&&(0,r.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[r.jsx("img",{src:URL.createObjectURL(u),alt:"Thumbnail preview",className:"h-20 rounded-lg object-cover"}),r.jsx("span",{className:"text-xs text-gray-400",children:"VIDEO"===l.type?"Auto-generated from video":"Selected"})]}),r.jsx("input",{type:"file",accept:"image/*",onChange:e=>p(e.target.files?.[0]||null),className:"text-sm"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"VIDEO"===l.type?"Thumbnail will be auto-generated from video if not provided":"Upload a cover image for your music"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title *"}),r.jsx("input",{type:"text",value:l.title,onChange:e=>d(t=>({...t,title:e.target.value})),placeholder:"Give your creation a title",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),r.jsx("textarea",{value:l.description,onChange:e=>d(t=>({...t,description:e.target.value})),placeholder:"Describe your AI-generated media...",rows:4,className:"resize-none"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Price (USD) - Leave empty for free"}),r.jsx("input",{type:"number",step:"0.01",min:"0",value:l.price,onChange:e=>d(t=>({...t,price:e.target.value})),placeholder:"e.g., 9.99 (leave empty for free content)"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"AI Tool Used"}),r.jsx("input",{type:"text",value:l.aiTool,onChange:e=>d(t=>({...t,aiTool:e.target.value})),placeholder:"e.g., Midjourney, DALL-E, Suno, Runway..."})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"AI Prompt"}),r.jsx("textarea",{value:l.aiPrompt,onChange:e=>d(t=>({...t,aiPrompt:e.target.value})),placeholder:"Share the prompt you used to generate this...",rows:3,className:"resize-none"})]}),g&&(0,r.jsxs)("div",{children:[r.jsx("div",{className:"h-2 bg-tank-light rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-tank-accent transition-all duration-300",style:{width:`${f}%`}})}),r.jsx("p",{className:"text-sm text-center text-gray-400 mt-2",children:w||`Uploading... ${f}%`})]}),r.jsx("button",{type:"submit",disabled:g||!c,className:"btn-primary w-full",children:g?"Uploading...":"Upload Media"})]})})]})}},91752:(e,t,a)=>{"use strict";a.d(t,{F$:()=>n,hv:()=>s});let r={maxWidth:1920,maxHeight:1080,quality:.8,maxSizeMB:5},i={maxWidth:1920,maxHeight:1080,maxSizeMB:100};async function s(e,t={}){let a={...r,...t};return new Promise((t,r)=>{let i=new Image,s=document.createElement("canvas"),o=s.getContext("2d");if(!o){r(Error("Could not get canvas context"));return}i.onload=()=>{let{width:n,height:l}=i,d=a.maxWidth||1920,c=a.maxHeight||1080;n>d&&(l=l*d/n,n=d),l>c&&(n=n*c/l,l=c),s.width=n,s.height=l,o.drawImage(i,0,0,n,l),s.toBlob(a=>{if(!a){r(Error("Failed to compress image"));return}let i=new File([a],e.name,{type:"image/jpeg",lastModified:Date.now()});console.log(`Image compressed: ${(e.size/1024/1024).toFixed(2)}MB -> ${(i.size/1024/1024).toFixed(2)}MB`),t(i)},"image/jpeg",a.quality||.8)},i.onerror=()=>r(Error("Failed to load image")),i.src=URL.createObjectURL(e)})}async function o(e,t={},a){let r={...i,...t};return new Promise((t,i)=>{let s=document.createElement("video");s.muted=!0,s.playsInline=!0,s.onloadedmetadata=async()=>{try{let{videoWidth:o,videoHeight:n}=s,l=r.maxWidth||1920,d=r.maxHeight||1080;o>l&&(n=n*l/o,o=l),n>d&&(o=o*d/n,n=d),o=2*Math.round(o/2),n=2*Math.round(n/2);let c=document.createElement("canvas");c.width=o,c.height=n;let m=c.getContext("2d");if(!m){i(Error("Could not get canvas context"));return}let u=c.captureStream(30);try{let e=new AudioContext,t=e.createMediaElementSource(s),a=e.createMediaStreamDestination();t.connect(a),t.connect(e.destination),a.stream.getAudioTracks().forEach(e=>{u.addTrack(e)})}catch(e){console.log("No audio track or audio context unavailable")}let p=new MediaRecorder(u,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5}),x=[];p.ondataavailable=e=>{e.data.size>0&&x.push(e.data)},p.onstop=()=>{let a=new Blob(x,{type:"video/webm"}),r=new File([a],e.name.replace(/\.[^.]+$/,".webm"),{type:"video/webm",lastModified:Date.now()});console.log(`Video compressed: ${(e.size/1024/1024).toFixed(2)}MB -> ${(r.size/1024/1024).toFixed(2)}MB`),t(r)},p.onerror=e=>i(e),p.start(100),s.currentTime=0,await s.play();let h=()=>{if(s.ended||s.paused){p.stop();return}if(m.drawImage(s,0,0,o,n),a){let e=s.currentTime/s.duration*100;a(Math.round(e))}requestAnimationFrame(h)};h(),s.onended=()=>{p.stop()}}catch(e){i(e)}},s.onerror=()=>i(Error("Failed to load video")),s.src=URL.createObjectURL(e)})}async function n(e,t,a){if(e.size<1048576*("IMAGE"===t?1:10))return console.log(`File is small (${(e.size/1024/1024).toFixed(2)}MB), skipping compression`),e;switch(t){case"IMAGE":return s(e);case"VIDEO":return o(e,{},a);case"MUSIC":return console.log("Audio compression not supported, using original file"),e;default:return e}}},64929:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>o,__esModule:()=>s,default:()=>n});var r=a(68570);let i=(0,r.createProxy)(String.raw`C:\Users\chong\AI Studio\aimediatank-azure\src\app\upload\page.tsx`),{__esModule:s,$$typeof:o}=i;i.default;let n=(0,r.createProxy)(String.raw`C:\Users\chong\AI Studio\aimediatank-azure\src\app\upload\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5559,4613],()=>a(98518));module.exports=r})();