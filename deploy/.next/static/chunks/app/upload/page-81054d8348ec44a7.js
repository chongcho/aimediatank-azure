(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[676],{5224:function(e,t,a){Promise.resolve().then(a.bind(a,5844))},6463:function(e,t,a){"use strict";var i=a(1169);a.o(i,"useParams")&&a.d(t,{useParams:function(){return i.useParams}}),a.o(i,"useRouter")&&a.d(t,{useRouter:function(){return i.useRouter}}),a.o(i,"useSearchParams")&&a.d(t,{useSearchParams:function(){return i.useSearchParams}})},5844:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return s}});var i=a(7437),r=a(2265),o=a(998),n=a(6463),l=a(4221);function s(){let{data:e,status:t}=(0,o.useSession)(),a=(0,n.useRouter)(),[s,c]=(0,r.useState)({title:"",description:"",type:"IMAGE",aiTool:"",aiPrompt:"",price:"",isPublic:!0}),[d,m]=(0,r.useState)(null),[u,p]=(0,r.useState)(null),[h,x]=(0,r.useState)(null),[g,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)(""),[f,j]=(0,r.useState)(0),[N,w]=(0,r.useState)("");if("loading"===t)return(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,i.jsx)("div",{className:"spinner"})});if(!e||"SUBSCRIBER"!==e.user.role&&"ADMIN"!==e.user.role)return(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),(0,i.jsx)("p",{className:"text-gray-400 mb-4",children:"Only subscribers can upload media."}),(0,i.jsx)("button",{onClick:()=>a.push("/register"),className:"btn-primary",children:"Become a Subscriber"})]})});let M=async e=>{try{let t=document.createElement("video");t.preload="metadata",t.muted=!0,t.playsInline=!0;let a=URL.createObjectURL(e);t.onloadeddata=()=>{t.currentTime=Math.min(1,.1*t.duration)},t.onseeked=()=>{try{let e=document.createElement("canvas"),i=Math.min(1,640/t.videoWidth);e.width=t.videoWidth*i,e.height=t.videoHeight*i;let r=e.getContext("2d");r&&(r.drawImage(t,0,0,e.width,e.height),e.toBlob(e=>{if(e){let t=new File([e],"thumbnail.jpg",{type:"image/jpeg"});p(t),console.log("Auto-generated video thumbnail")}URL.revokeObjectURL(a)},"image/jpeg",.8))}catch(e){console.log("Could not generate video thumbnail:",e),URL.revokeObjectURL(a)}},t.onerror=()=>{console.log("Video thumbnail generation failed"),URL.revokeObjectURL(a)},t.src=a}catch(e){console.log("Error generating video thumbnail:",e)}},E=async(e,t)=>{w("Getting upload URL...");let a=await fetch("/api/upload/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:e.name,contentType:e.type,fileType:t})});if(!a.ok)throw Error((await a.json()).error||"Failed to get upload URL");let{uploadUrl:i,blobUrl:r}=await a.json();if(w("Uploading to cloud storage..."),!(await fetch(i,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":e.type},body:e})).ok)throw Error("Failed to upload file to storage");return r},I=async e=>{if(e.preventDefault(),v(""),!d){v("Please select a file to upload");return}if(!s.title.trim()){v("Please enter a title");return}b(!0),j(0);try{w("Compressing file..."),j(5);let e=await (0,l.F$)(d,s.type,e=>{j(5+Math.round(.25*e)),w("Compressing... ".concat(e,"%"))});console.log("Original: ".concat((d.size/1024/1024).toFixed(2),"MB, Compressed: ").concat((e.size/1024/1024).toFixed(2),"MB")),j(30);let t=await E(e,s.type);j(70);let i=null;if(u){w("Compressing thumbnail...");let e=await (0,l.F$)(u,"IMAGE");w("Uploading thumbnail..."),i=await E(e,"IMAGE")}j(85),w("Saving media...");let r=await fetch("/api/upload/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:s.title,description:s.description,type:s.type,url:t,thumbnailUrl:i,aiTool:s.aiTool,aiPrompt:s.aiPrompt,price:s.price||null,isPublic:s.isPublic})});j(100);let o=await r.json();r.ok?(w("Upload complete!"),a.push("/media/".concat(o.media.id))):v(o.error||"Failed to save media")}catch(e){console.error("Upload error:",e),v(e instanceof Error?e.message:"Something went wrong")}finally{b(!1)}};return(0,i.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-12",children:[(0,i.jsxs)("div",{className:"text-center mb-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Upload AI Media"}),(0,i.jsx)("p",{className:"text-gray-400",children:"Share your AI-generated videos, images, or music with the community"})]}),(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[y&&(0,i.jsx)("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 text-sm",children:y}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Media Type *"}),(0,i.jsx)("div",{className:"grid grid-cols-3 gap-3",children:["IMAGE","VIDEO","MUSIC"].map(e=>(0,i.jsxs)("button",{type:"button",onClick:()=>c(t=>({...t,type:e})),className:"p-4 rounded-xl border transition-all ".concat(s.type===e?"border-tank-accent bg-tank-accent/10":"border-tank-light hover:border-gray-600"),children:[(0,i.jsx)("div",{className:"text-2xl mb-2",children:"IMAGE"===e?"\uD83D\uDDBC️":"VIDEO"===e?"\uD83C\uDFAC":"\uD83C\uDFB5"}),(0,i.jsx)("div",{className:"font-medium",children:e})]},e))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"File *"}),(0,i.jsx)("div",{className:"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ".concat(d?"border-tank-accent bg-tank-accent/5":"border-tank-light hover:border-gray-600"),onClick:()=>{var e;return null===(e=document.getElementById("file-input"))||void 0===e?void 0:e.click()},children:h?(0,i.jsxs)("div",{className:"space-y-4",children:["IMAGE"===s.type&&(0,i.jsx)("img",{src:h,alt:"Preview",className:"max-h-64 mx-auto rounded-lg"}),"VIDEO"===s.type&&(0,i.jsx)("video",{src:h,controls:!0,className:"max-h-64 mx-auto rounded-lg"}),(0,i.jsx)("p",{className:"text-sm text-gray-400",children:null==d?void 0:d.name})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC1"}),(0,i.jsx)("p",{className:"text-gray-400",children:"Click to select or drag and drop your file"}),(0,i.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["VIDEO"===s.type&&"MP4, WebM, MOV","IMAGE"===s.type&&"JPG, PNG, GIF, WebP","MUSIC"===s.type&&"MP3, WAV, OGG"]})]})}),(0,i.jsx)("input",{id:"file-input",type:"file",accept:"VIDEO"===s.type?"video/*":"IMAGE"===s.type?"image/*":"audio/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if(m(a),a.type.startsWith("image/")){let e=new FileReader;e.onload=()=>x(e.result),e.readAsDataURL(a)}else a.type.startsWith("video/")?(x(URL.createObjectURL(a)),M(a)):x(null)}},className:"hidden"})]}),("VIDEO"===s.type||"MUSIC"===s.type)&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Thumbnail ",u?"✓":"(optional)"]}),u&&(0,i.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,i.jsx)("img",{src:URL.createObjectURL(u),alt:"Thumbnail preview",className:"h-20 rounded-lg object-cover"}),(0,i.jsx)("span",{className:"text-xs text-gray-400",children:"VIDEO"===s.type?"Auto-generated from video":"Selected"})]}),(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return p((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"text-sm"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"VIDEO"===s.type?"Thumbnail will be auto-generated from video if not provided":"Upload a cover image for your music"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title *"}),(0,i.jsx)("input",{type:"text",value:s.title,onChange:e=>c(t=>({...t,title:e.target.value})),placeholder:"Give your creation a title",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),(0,i.jsx)("textarea",{value:s.description,onChange:e=>c(t=>({...t,description:e.target.value})),placeholder:"Describe your AI-generated media...",rows:4,className:"resize-none"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Price (USD) - Leave empty for free"}),(0,i.jsx)("input",{type:"number",step:"0.01",min:"0",value:s.price,onChange:e=>c(t=>({...t,price:e.target.value})),placeholder:"e.g., 9.99 (leave empty for free content)"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"AI Tool Used"}),(0,i.jsx)("input",{type:"text",value:s.aiTool,onChange:e=>c(t=>({...t,aiTool:e.target.value})),placeholder:"e.g., Midjourney, DALL-E, Suno, Runway..."})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"AI Prompt"}),(0,i.jsx)("textarea",{value:s.aiPrompt,onChange:e=>c(t=>({...t,aiPrompt:e.target.value})),placeholder:"Share the prompt you used to generate this...",rows:3,className:"resize-none"})]}),g&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"h-2 bg-tank-light rounded-full overflow-hidden",children:(0,i.jsx)("div",{className:"h-full bg-tank-accent transition-all duration-300",style:{width:"".concat(f,"%")}})}),(0,i.jsx)("p",{className:"text-sm text-center text-gray-400 mt-2",children:N||"Uploading... ".concat(f,"%")})]}),(0,i.jsx)("button",{type:"submit",disabled:g||!d,className:"btn-primary w-full",children:g?"Uploading...":"Upload Media"})]})})]})}},4221:function(e,t,a){"use strict";a.d(t,{F$:function(){return l},hv:function(){return o}});let i={maxWidth:1920,maxHeight:1080,quality:.8,maxSizeMB:5},r={maxWidth:1920,maxHeight:1080,maxSizeMB:100};async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={...i,...t};return new Promise((t,i)=>{let r=new Image,o=document.createElement("canvas"),n=o.getContext("2d");if(!n){i(Error("Could not get canvas context"));return}r.onload=()=>{let{width:l,height:s}=r,c=a.maxWidth||1920,d=a.maxHeight||1080;l>c&&(s=s*c/l,l=c),s>d&&(l=l*d/s,s=d),o.width=l,o.height=s,n.drawImage(r,0,0,l,s),o.toBlob(a=>{if(!a){i(Error("Failed to compress image"));return}let r=new File([a],e.name,{type:"image/jpeg",lastModified:Date.now()});console.log("Image compressed: ".concat((e.size/1024/1024).toFixed(2),"MB -> ").concat((r.size/1024/1024).toFixed(2),"MB")),t(r)},"image/jpeg",a.quality||.8)},r.onerror=()=>i(Error("Failed to load image")),r.src=URL.createObjectURL(e)})}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,i={...r,...t};return new Promise((t,r)=>{let o=document.createElement("video");o.muted=!0,o.playsInline=!0,o.onloadedmetadata=async()=>{try{let{videoWidth:n,videoHeight:l}=o,s=i.maxWidth||1920,c=i.maxHeight||1080;n>s&&(l=l*s/n,n=s),l>c&&(n=n*c/l,l=c),n=2*Math.round(n/2),l=2*Math.round(l/2);let d=document.createElement("canvas");d.width=n,d.height=l;let m=d.getContext("2d");if(!m){r(Error("Could not get canvas context"));return}let u=d.captureStream(30);try{let e=new AudioContext,t=e.createMediaElementSource(o),a=e.createMediaStreamDestination();t.connect(a),t.connect(e.destination),a.stream.getAudioTracks().forEach(e=>{u.addTrack(e)})}catch(e){console.log("No audio track or audio context unavailable")}let p=new MediaRecorder(u,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5}),h=[];p.ondataavailable=e=>{e.data.size>0&&h.push(e.data)},p.onstop=()=>{let a=new Blob(h,{type:"video/webm"}),i=new File([a],e.name.replace(/\.[^.]+$/,".webm"),{type:"video/webm",lastModified:Date.now()});console.log("Video compressed: ".concat((e.size/1024/1024).toFixed(2),"MB -> ").concat((i.size/1024/1024).toFixed(2),"MB")),t(i)},p.onerror=e=>r(e),p.start(100),o.currentTime=0,await o.play();let x=()=>{if(o.ended||o.paused){p.stop();return}if(m.drawImage(o,0,0,n,l),a){let e=o.currentTime/o.duration*100;a(Math.round(e))}requestAnimationFrame(x)};x(),o.onended=()=>{p.stop()}}catch(e){r(e)}},o.onerror=()=>r(Error("Failed to load video")),o.src=URL.createObjectURL(e)})}async function l(e,t,a){if(e.size<1048576*("IMAGE"===t?1:10))return console.log("File is small (".concat((e.size/1024/1024).toFixed(2),"MB), skipping compression")),e;switch(t){case"IMAGE":return o(e);case"VIDEO":return n(e,{},a);case"MUSIC":return console.log("Audio compression not supported, using original file"),e;default:return e}}}},function(e){e.O(0,[998,971,23,744],function(){return e(e.s=5224)}),_N_E=e.O()}]);