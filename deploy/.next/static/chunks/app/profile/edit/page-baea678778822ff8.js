(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{9063:function(e,a,t){Promise.resolve().then(t.bind(t,812))},6463:function(e,a,t){"use strict";var r=t(1169);t.o(r,"useParams")&&t.d(a,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},812:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return i}});var r=t(7437),s=t(2265),l=t(998),n=t(6463),o=t(4221);function i(){var e,a,t,i;let{data:d,status:c}=(0,l.useSession)(),u=(0,n.useRouter)(),[m,h]=(0,s.useState)(!0),[x,p]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1),[v,b]=(0,s.useState)(""),[y,w]=(0,s.useState)(""),[j,N]=(0,s.useState)(!1),[k,C]=(0,s.useState)(""),[S,P]=(0,s.useState)({name:"",legalName:"",username:"",email:"",phone:"",location:"",ageRange:"",bio:"",password:"",confirmPassword:"",emailVerified:!1,avatar:null}),[E,U]=(0,s.useState)(null),[L,R]=(0,s.useState)(!1),M=(0,s.useRef)(null);(0,s.useEffect)(()=>{"unauthenticated"===c?u.push("/login"):"authenticated"===c&&F()},[c]);let F=async()=>{try{let e=await fetch("/api/user/profile"),a=await e.json();a.user&&(P({name:a.user.name||"",legalName:a.user.legalName||"",username:a.user.username||"",email:a.user.email||"",phone:a.user.phone||"",location:a.user.location||"",ageRange:a.user.ageRange||"",bio:a.user.bio||"",password:"",confirmPassword:"",emailVerified:a.user.emailVerified||!1,avatar:a.user.avatar||null}),a.user.avatar&&U(a.user.avatar))}catch(e){console.error("Error fetching profile:",e),b("Failed to load profile")}finally{h(!1)}},T=async e=>{var a;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!t)return;if(!t.type.startsWith("image/")){b("Please select an image file");return}let r=URL.createObjectURL(t);U(r),R(!0),b("");try{let e=await (0,o.hv)(t,{maxWidth:400,maxHeight:400,quality:.8}),a=await fetch("/api/upload/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:"avatar-".concat(Date.now(),".jpg"),contentType:"image/jpeg",fileType:"IMAGE"})});if(!a.ok)throw Error("Failed to get upload URL");let{uploadUrl:s,blobUrl:l}=await a.json();if(!(await fetch(s,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":"image/jpeg"},body:e})).ok)throw Error("Failed to upload avatar");if(!(await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:l})})).ok)throw Error("Failed to save avatar");let n="".concat(l,"?t=").concat(Date.now());U(n),P(e=>({...e,avatar:l})),URL.revokeObjectURL(r),window.dispatchEvent(new Event("profileUpdated")),w("Avatar updated successfully!"),setTimeout(()=>w(""),3e3)}catch(e){console.error("Avatar upload error:",e),b("Failed to upload avatar. Please try again."),U(S.avatar),URL.revokeObjectURL(r)}finally{R(!1)}},B=async()=>{f(!0),N(!1),C("");try{let e=await fetch("/api/auth/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S.email})}),a=await e.json();e.ok?(N(!0),a.devUrl&&C(a.devUrl)):b(a.error||"Failed to send verification email")}catch(e){b("Something went wrong")}finally{f(!1)}},V=async e=>{if(e.preventDefault(),b(""),w(""),S.password&&S.password!==S.confirmPassword){b("Passwords do not match");return}if(S.password&&S.password.length<6){b("Password must be at least 6 characters");return}p(!0);try{let e={name:S.name,legalName:S.legalName,username:S.username,email:S.email,phone:S.phone,location:S.location,ageRange:S.ageRange,bio:S.bio,avatar:S.avatar};S.password&&(e.password=S.password);let a=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();a.ok?(w("Profile updated successfully!"),P(e=>({...e,password:"",confirmPassword:""})),window.dispatchEvent(new Event("profileUpdated")),setTimeout(()=>{u.push("/profile/".concat(t.user.username))},1500)):b(t.error||"Failed to update profile")}catch(e){b("Something went wrong")}finally{p(!1)}};return"loading"===c||m?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"spinner"})}):(0,r.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-12",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Edit Profile"}),(0,r.jsx)("p",{className:"text-gray-400",children:"Update your account information"})]}),(0,r.jsx)("div",{className:"card",children:(0,r.jsxs)("form",{onSubmit:V,className:"space-y-6",children:[v&&(0,r.jsx)("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 text-sm",children:v}),y&&(0,r.jsx)("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-xl text-green-400 text-sm",children:y}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsxs)("div",{className:"w-24 h-24 rounded-full overflow-hidden border-2 border-tank-light",children:[E?(0,r.jsx)("img",{src:E,alt:"Avatar",className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-tank-accent to-purple-500 flex items-center justify-center text-3xl font-bold",children:(null===(a=S.name)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.toUpperCase())||(null===(i=S.username)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.toUpperCase())||"?"}),L&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full",children:(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})})]})}),(0,r.jsx)("input",{ref:M,type:"file",accept:"image/*",onChange:T,className:"hidden"}),(0,r.jsxs)("button",{type:"button",onClick:()=>{var e;null===(e=M.current)||void 0===e||e.click()},disabled:L,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-tank-gray hover:bg-tank-light border border-tank-light rounded-lg transition-colors disabled:opacity-50",children:[(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),L?"Uploading...":"Edit Avatar"]})]}),(0,r.jsxs)("div",{className:"text-left space-y-2",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",value:S.name,onChange:e=>P({...S,name:e.target.value}),placeholder:"Your Name",className:"text-2xl font-bold bg-transparent border-b-2 border-transparent hover:border-tank-light focus:border-tank-accent transition-colors outline-none w-full"})}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Nickname"})]})]}),(0,r.jsxs)("div",{className:"p-4 rounded-xl ".concat(S.emailVerified?"bg-green-500/10 border border-green-500/30":"bg-yellow-500/10 border border-yellow-500/30"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[S.emailVerified?(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium ".concat(S.emailVerified?"text-green-400":"text-yellow-400"),children:S.emailVerified?"Email Verified":"Email Not Verified"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:S.emailVerified?"Your email address has been verified":"Please verify your email address"})]})]}),!S.emailVerified&&(0,r.jsx)("button",{type:"button",onClick:B,disabled:g||j,className:"px-3 py-1.5 bg-yellow-500/20 text-yellow-400 rounded-lg text-sm hover:bg-yellow-500/30 disabled:opacity-50",children:g?"Sending...":j?"Sent!":"Verify"})]}),k&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-yellow-500/20",children:[(0,r.jsx)("p",{className:"text-xs text-yellow-400 mb-1",children:"\uD83D\uDD27 Dev verification link:"}),(0,r.jsx)("a",{href:k,className:"text-xs text-tank-accent break-all hover:underline",children:k})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"User Name (Legal Name)"}),(0,r.jsx)("input",{type:"text",value:S.legalName,onChange:e=>P({...S,legalName:e.target.value}),placeholder:"Your full legal name",className:"w-full"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Your legal name for account records"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"User ID *"}),(0,r.jsx)("input",{type:"text",value:S.username,onChange:e=>P({...S,username:e.target.value}),placeholder:"username",className:"w-full",required:!0}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Used for login and your profile URL"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email *"}),(0,r.jsx)("input",{type:"email",value:S.email,onChange:e=>P({...S,email:e.target.value}),placeholder:"your@email.com",className:"w-full",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Phone Number"}),(0,r.jsx)("input",{type:"tel",value:S.phone,onChange:e=>P({...S,phone:e.target.value}),placeholder:"+1 (555) 000-0000",className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),(0,r.jsx)("input",{type:"text",value:S.location,onChange:e=>P({...S,location:e.target.value}),placeholder:"City, Country",className:"w-full"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Age Range *"}),(0,r.jsxs)("select",{value:S.ageRange,onChange:e=>P({...S,ageRange:e.target.value}),className:"w-full",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select your age range"}),(0,r.jsx)("option",{value:"UNDER_18",children:"Under 18"}),(0,r.jsx)("option",{value:"18_PLUS",children:"18 and over"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Required for content filtering"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Bio"}),(0,r.jsx)("textarea",{value:S.bio,onChange:e=>P({...S,bio:e.target.value}),placeholder:"Tell others about yourself...",rows:3,className:"w-full resize-none"})]}),(0,r.jsxs)("div",{className:"border-t border-tank-light pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Change Password"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"Leave blank to keep current password"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"New Password"}),(0,r.jsx)("input",{type:"password",value:S.password,onChange:e=>P({...S,password:e.target.value}),placeholder:"••••••••",className:"w-full",minLength:6})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm New Password"}),(0,r.jsx)("input",{type:"password",value:S.confirmPassword,onChange:e=>P({...S,confirmPassword:e.target.value}),placeholder:"••••••••",className:"w-full"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>u.back(),className:"flex-1 px-4 py-3 bg-tank-gray border border-tank-light rounded-xl hover:bg-tank-light transition-colors",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:x,className:"flex-1 btn-primary",children:x?"Saving...":"Save Changes"})]})]})})]})}},4221:function(e,a,t){"use strict";t.d(a,{F$:function(){return o},hv:function(){return l}});let r={maxWidth:1920,maxHeight:1080,quality:.8,maxSizeMB:5},s={maxWidth:1920,maxHeight:1080,maxSizeMB:100};async function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={...r,...a};return new Promise((a,r)=>{let s=new Image,l=document.createElement("canvas"),n=l.getContext("2d");if(!n){r(Error("Could not get canvas context"));return}s.onload=()=>{let{width:o,height:i}=s,d=t.maxWidth||1920,c=t.maxHeight||1080;o>d&&(i=i*d/o,o=d),i>c&&(o=o*c/i,i=c),l.width=o,l.height=i,n.drawImage(s,0,0,o,i),l.toBlob(t=>{if(!t){r(Error("Failed to compress image"));return}let s=new File([t],e.name,{type:"image/jpeg",lastModified:Date.now()});console.log("Image compressed: ".concat((e.size/1024/1024).toFixed(2),"MB -> ").concat((s.size/1024/1024).toFixed(2),"MB")),a(s)},"image/jpeg",t.quality||.8)},s.onerror=()=>r(Error("Failed to load image")),s.src=URL.createObjectURL(e)})}async function n(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0,r={...s,...a};return new Promise((a,s)=>{let l=document.createElement("video");l.muted=!0,l.playsInline=!0,l.onloadedmetadata=async()=>{try{let{videoWidth:n,videoHeight:o}=l,i=r.maxWidth||1920,d=r.maxHeight||1080;n>i&&(o=o*i/n,n=i),o>d&&(n=n*d/o,o=d),n=2*Math.round(n/2),o=2*Math.round(o/2);let c=document.createElement("canvas");c.width=n,c.height=o;let u=c.getContext("2d");if(!u){s(Error("Could not get canvas context"));return}let m=c.captureStream(30);try{let e=new AudioContext,a=e.createMediaElementSource(l),t=e.createMediaStreamDestination();a.connect(t),a.connect(e.destination),t.stream.getAudioTracks().forEach(e=>{m.addTrack(e)})}catch(e){console.log("No audio track or audio context unavailable")}let h=new MediaRecorder(m,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5}),x=[];h.ondataavailable=e=>{e.data.size>0&&x.push(e.data)},h.onstop=()=>{let t=new Blob(x,{type:"video/webm"}),r=new File([t],e.name.replace(/\.[^.]+$/,".webm"),{type:"video/webm",lastModified:Date.now()});console.log("Video compressed: ".concat((e.size/1024/1024).toFixed(2),"MB -> ").concat((r.size/1024/1024).toFixed(2),"MB")),a(r)},h.onerror=e=>s(e),h.start(100),l.currentTime=0,await l.play();let p=()=>{if(l.ended||l.paused){h.stop();return}if(u.drawImage(l,0,0,n,o),t){let e=l.currentTime/l.duration*100;t(Math.round(e))}requestAnimationFrame(p)};p(),l.onended=()=>{h.stop()}}catch(e){s(e)}},l.onerror=()=>s(Error("Failed to load video")),l.src=URL.createObjectURL(e)})}async function o(e,a,t){if(e.size<1048576*("IMAGE"===a?1:10))return console.log("File is small (".concat((e.size/1024/1024).toFixed(2),"MB), skipping compression")),e;switch(a){case"IMAGE":return l(e);case"VIDEO":return n(e,{},t);case"MUSIC":return console.log("Audio compression not supported, using original file"),e;default:return e}}}},function(e){e.O(0,[998,971,23,744],function(){return e(e.s=9063)}),_N_E=e.O()}]);