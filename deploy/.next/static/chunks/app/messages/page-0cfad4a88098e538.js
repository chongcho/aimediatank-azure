(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{5078:function(e,n,t){Promise.resolve().then(t.bind(t,2216))},6463:function(e,n,t){"use strict";var s=t(1169);t.o(s,"useParams")&&t.d(n,{useParams:function(){return s.useParams}}),t.o(s,"useRouter")&&t.d(n,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(n,{useSearchParams:function(){return s.useSearchParams}})},2216:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return d}});var s=t(7437),a=t(2265),i=t(998),l=t(6463),r=t(7138);function d(){var e,n,t,d,c,o,u,m,x,v,h,f,p,g;let{data:b,status:j}=(0,i.useSession)(),y=(0,l.useRouter)(),[N,k]=(0,a.useState)([]),[w,S]=(0,a.useState)(!0),[C,R]=(0,a.useState)("inbox"),[P,E]=(0,a.useState)(null),[T,U]=(0,a.useState)(""),[_,O]=(0,a.useState)(!1);(0,a.useEffect)(()=>{"unauthenticated"===j&&y.push("/login")},[j,y]),(0,a.useEffect)(()=>{b&&A()},[b,C]);let A=async()=>{S(!0);try{let e=await fetch("/api/messages?type=".concat(C)),n=await e.json();k(n.messages||[])}catch(e){console.error("Error fetching messages:",e)}finally{S(!1)}},D=async e=>{try{await fetch("/api/messages",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageIds:e})})}catch(e){console.error("Error marking as read:",e)}},J=e=>{E(e),e.isRead||"inbox"!==C||(D([e.id]),k(n=>n.map(n=>n.id===e.id?{...n,isRead:!0}:n)))},L=async()=>{var e,n;if(!T.trim()||!P)return;let t="inbox"===C?null===(e=P.sender)||void 0===e?void 0:e.id:null===(n=P.receiver)||void 0===n?void 0:n.id;if(t){O(!0);try{(await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:t,content:T})})).ok&&(U(""),alert("Reply sent!"))}catch(e){console.error("Error sending reply:",e)}finally{O(!1)}}},M=e=>{let n=new Date(e),t=Math.floor((new Date().getTime()-n.getTime())/864e5);return 0===t?n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):1===t?"Yesterday":t<7?"".concat(t," days ago"):n.toLocaleDateString("en-US",{month:"short",day:"numeric"})};if("loading"===j)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"spinner"})});if(!b)return null;let z=N.filter(e=>!e.isRead).length;return(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Messages"}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-1",children:[(0,s.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,s.jsxs)("button",{onClick:()=>{R("inbox"),E(null)},className:"flex-1 px-4 py-2 rounded-xl font-medium ".concat("inbox"===C?"bg-tank-accent text-tank-black":"bg-tank-gray text-gray-400"),children:["Inbox","inbox"===C&&z>0&&(0,s.jsx)("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:z})]}),(0,s.jsx)("button",{onClick:()=>{R("sent"),E(null)},className:"flex-1 px-4 py-2 rounded-xl font-medium ".concat("sent"===C?"bg-tank-accent text-tank-black":"bg-tank-gray text-gray-400"),children:"Sent"})]}),(0,s.jsx)("div",{className:"card p-0 overflow-hidden",children:w?(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsx)("div",{className:"spinner mx-auto"})}):0===N.length?(0,s.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No messages yet"}):(0,s.jsx)("div",{className:"divide-y divide-tank-light max-h-[60vh] overflow-y-auto",children:N.map(e=>{var n,t;let a="inbox"===C?e.sender:e.receiver;return(0,s.jsx)("button",{onClick:()=>J(e),className:"w-full p-4 text-left hover:bg-tank-light/50 transition-colors ".concat((null==P?void 0:P.id)===e.id?"bg-tank-light":""," ").concat(e.isRead||"inbox"!==C?"":"bg-tank-accent/5"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-tank-accent to-purple-500 flex-shrink-0 flex items-center justify-center text-sm font-bold",children:(null==a?void 0:null===(t=a.name)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.toUpperCase())||(null==a?void 0:a.username[0].toUpperCase())}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium truncate",children:(null==a?void 0:a.name)||(null==a?void 0:a.username)}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:M(e.createdAt)})]}),(0,s.jsx)("p",{className:"text-sm text-gray-400 truncate",children:e.content})]}),!e.isRead&&"inbox"===C&&(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-tank-accent flex-shrink-0 mt-2"})]})},e.id)})})})]}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsx)("div",{className:"card h-full",children:P?(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 pb-4 border-b border-tank-light",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-tank-accent to-purple-500 flex items-center justify-center font-bold",children:(null===(e="inbox"===C?null===(t=P.sender)||void 0===t?void 0:null===(n=t.name)||void 0===n?void 0:n[0]:null===(c=P.receiver)||void 0===c?void 0:null===(d=c.name)||void 0===d?void 0:d[0])||void 0===e?void 0:e.toUpperCase())||(null===(o="inbox"===C?null===(u=P.sender)||void 0===u?void 0:u.username[0]:null===(m=P.receiver)||void 0===m?void 0:m.username[0])||void 0===o?void 0:o.toUpperCase())}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.default,{href:"/profile/".concat("inbox"===C?null===(x=P.sender)||void 0===x?void 0:x.username:null===(v=P.receiver)||void 0===v?void 0:v.username),className:"font-semibold hover:text-tank-accent",children:"inbox"===C?(null===(h=P.sender)||void 0===h?void 0:h.name)||(null===(f=P.sender)||void 0===f?void 0:f.username):(null===(p=P.receiver)||void 0===p?void 0:p.name)||(null===(g=P.receiver)||void 0===g?void 0:g.username)}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:M(P.createdAt)})]})]}),(0,s.jsx)("div",{className:"flex-1 py-6",children:(0,s.jsx)("p",{className:"text-gray-300 whitespace-pre-wrap",children:P.content})}),"inbox"===C&&(0,s.jsxs)("div",{className:"pt-4 border-t border-tank-light",children:[(0,s.jsx)("textarea",{value:T,onChange:e=>U(e.target.value),placeholder:"Write a reply...",rows:3,className:"mb-3 resize-none"}),(0,s.jsx)("button",{onClick:L,disabled:!T.trim()||_,className:"btn-primary",children:_?"Sending...":"Send Reply"})]})]}):(0,s.jsx)("div",{className:"h-full flex items-center justify-center text-gray-500",children:"Select a message to view"})})})]})]})}}},function(e){e.O(0,[998,138,971,23,744],function(){return e(e.s=5078)}),_N_E=e.O()}]);